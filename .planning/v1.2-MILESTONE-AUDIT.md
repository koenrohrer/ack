---
milestone: v1.2
milestone_name: Copilot Support
audited: 2026-02-26T00:00:00Z
status: passed
scores:
  requirements: 22/22
  phases_complete: 6/6
  integration: 22/22
  flows: 7/7
gaps:
  requirements: []
  integration: []
  flows: []
tech_debt:
  - phase: 20-copilot-adapter-scaffold
    items:
      - "writeTool() stub throws Error with stale 'Phase 21+' message — should reference 'Phase 22+' or later; method is never called in production (cosmetic only)"
  - phase: 21-mcp-server-support
    items:
      - "getJsonPath heuristic in tool-tree.command-utils.ts is path-string-based (.vscode path check) rather than adapter-metadata-based — intentional design decision documented in 21-02 SUMMARY"
  - phase: 23-custom-agents
    items:
      - "getSkillsDir() still throws 'Phase 23+' error — Phase 23 completed but installSkill() routes directly through CopilotPaths.workspaceAgentsDir(); getSkillsDir never called in production (cosmetic only)"
---

# v1.2 Milestone Audit — Copilot Support (Full)

**Milestone Goal:** GitHub Copilot added as a fully supported third agent with feature parity to Claude Code and Codex — MCP servers, custom instructions, custom agents, agent-scoped profiles, and marketplace routing all work for Copilot users.

**Audited:** 2026-02-26
**Status:** passed — all 6 phases verified, all 22 requirements satisfied, all E2E flows complete

---

## Summary

| Category | Result |
|----------|--------|
| Requirements | **22/22 satisfied** |
| Phase verifications | **6/6 passed** |
| Integration check | **22/22 requirements wired** |
| E2E flows | **7/7 complete** |
| Orphaned requirements | **0** |
| Critical gaps | **0** |
| Tech debt items | **3** (non-blocking, cosmetic) |

---

## Requirements Coverage (3-Source Cross-Reference)

| REQ-ID | Description | Phase | VERIFICATION.md | SUMMARY Frontmatter | REQUIREMENTS.md | Final Status |
|--------|-------------|-------|-----------------|---------------------|-----------------|--------------|
| UX-01 | User can select GitHub Copilot in agent switcher QuickPick | 20 | SATISFIED | listed (20-01, 20-02) | `[x]` | **satisfied** |
| UX-02 | Extension detects Copilot via VS Code Extension API (not filesystem) | 20 | SATISFIED | listed (20-01, 20-02) | `[x]` | **satisfied** |
| UX-03 | Sidebar, marketplace, profile panel update when Copilot active | 20 | SATISFIED | listed (20-02) | `[x]` | **satisfied** |
| MCP-01 | View workspace-scoped Copilot MCP servers in sidebar | 21 | SATISFIED | listed (21-01, 21-02) | `[x]` | **satisfied** |
| MCP-02 | View user-scoped Copilot MCP servers in sidebar | 21 | SATISFIED | listed (21-01, 21-02) | `[x]` | **satisfied** |
| MCP-03 | Install Copilot MCP server from marketplace | 21 | SATISFIED | listed (21-01, 21-02) | `[x]` | **satisfied** |
| MCP-04 | Remove Copilot MCP server from sidebar | 21 | SATISFIED | listed (21-01, 21-02) | `[x]` | **satisfied** |
| MCP-05 | Sidebar auto-refreshes when .vscode/mcp.json edited externally | 21 | SATISFIED | listed (21-02) | `[x]` | **satisfied** |
| INST-01 | View always-on instructions file in sidebar | 22 | SATISFIED | listed (22-01) | `[x]` | **satisfied** |
| INST-02 | View file-pattern instruction files in sidebar | 22 | SATISFIED | listed (22-01) | `[x]` | **satisfied** |
| INST-03 | View prompt files in sidebar | 22 | SATISFIED | listed (22-01) | `[x]` | **satisfied** |
| INST-04 | Install instruction/prompt files from marketplace | 22 | SATISFIED | listed (22-04) | `[x]` | **satisfied** |
| INST-05 | Delete instruction/prompt files from sidebar | 22 | SATISFIED | listed (22-03) | `[x]` | **satisfied** |
| INST-06 | Preview instruction and prompt file content | 22 | SATISFIED | listed (22-03) | `[x]` | **satisfied** |
| AGNT-01 | View custom agent files in sidebar | 23 | PASS | listed (23-01) | `[x]` | **satisfied** |
| AGNT-02 | Enable/disable custom agent (toggle user-invokable) | 23 | PASS | listed (23-02) | `[x]` | **satisfied** |
| AGNT-03 | Install custom agent from marketplace | 23 | PASS | listed (23-03) | `[x]` | **satisfied** |
| AGNT-04 | Delete custom agent from sidebar | 23 | PASS | listed (23-02) | `[x]` | **satisfied** |
| AGNT-05 | Preview custom agent file content | 23 | PASS | listed (23-03) | `[x]` | **satisfied** |
| UX-04 | Create, switch, delete Copilot-specific profiles | 24 | SATISFIED (code + human) | listed (24-01, 24-02) | `[x]` | **satisfied** |
| UX-05 | Export/import Copilot profiles as .ackprofile bundles | 24 | SATISFIED (code + human) | listed (24-01, 24-02) | `[x]` | **satisfied** |
| UX-06 | Marketplace shows only Copilot-compatible tools when active | 25 | SATISFIED | listed (25-01) | `[x]` | **satisfied** |
| UX-07 | Marketplace install routes to CopilotAdapter when Copilot active | 25 | SATISFIED | listed (25-02) | `[x]` | **satisfied** |

**Score: 22/22 requirements satisfied. No orphaned requirements.**

---

## Phase Verification Status

| Phase | Name | Score | Status | Human Verified |
|-------|------|-------|--------|----------------|
| 20 | CopilotAdapter Scaffold | 12/12 | **passed** | Yes (QuickPick, configDir) |
| 21 | MCP Server Support | 11/11 | **passed** | Yes (all 5 MCP reqs in Extension Dev Host) |
| 22 | Custom Instructions and Prompts | 10/10 | **passed** | Yes (all 6 INST reqs in Extension Dev Host) |
| 23 | Custom Agents | 5/5 | **passed** | Yes (all 5 AGNT reqs in Extension Dev Host) |
| 24 | Agent-Scoped Profiles | 3/3 | **passed** | Yes (UX-04, UX-05 in Extension Dev Host) |
| 25 | Marketplace Routing | 7/7 | **passed** | Pending (visual CSS, TypeTabs, registry install) |

---

## Integration Check Results

**Performed by:** gsd-integration-checker (sonnet)
**Result:** 22/22 requirements wired, 7/7 E2E flows complete, 0 orphaned exports, 0 broken flows

### E2E Flows

| Flow | Description | Requirements | Status |
|------|-------------|-------------|--------|
| 1 | User selects Copilot in QuickPick, all UI surfaces update | UX-01, UX-02, UX-03 | COMPLETE |
| 2 | View MCP servers in sidebar (workspace + user scope) with auto-refresh | MCP-01, MCP-02, MCP-05 | COMPLETE |
| 3 | Install Copilot MCP server from marketplace to .vscode/mcp.json | MCP-03, UX-07 | COMPLETE |
| 4 | Install instruction/prompt from marketplace (registry + repo paths) | INST-04, UX-07 | COMPLETE |
| 5 | View/toggle/delete custom agents in sidebar | AGNT-01, AGNT-02, AGNT-04, AGNT-05 | COMPLETE |
| 6 | Create/switch/delete Copilot profile with agent scoping | UX-04, UX-05 | COMPLETE |
| 7 | Marketplace shows Copilot-compatible tools and filters by type | UX-06 | COMPLETE |

### Requirements Integration Map

| Requirement | Integration Path | Status |
|-------------|-----------------|--------|
| UX-01 | `showAgentQuickPick` -> `adapter.detect()` -> `CopilotAdapter.detect()` -> `vscode.extensions.getExtension` -> item shown | WIRED |
| UX-02 | `CopilotAdapter.detect()` checks both `GitHub.copilot` AND `GitHub.copilot-chat` (21-04 fix) | WIRED |
| UX-03 | `agentSwitcher.onDidSwitchAgent` -> fan-out: MarketplacePanel + ConfigPanel + treeProvider + statusBar | WIRED |
| MCP-01 | `CopilotAdapter.readTools(McpServer, Project)` -> `parseCopilotMcpFile(workspaceMcpJson)` -> `servers` key | WIRED |
| MCP-02 | `CopilotAdapter.readTools(McpServer, User)` -> `parseCopilotMcpFile(userMcpJson)` -> `servers` key | WIRED |
| MCP-03 | `MarketplacePanel.executeInstall` -> `InstallService.installMcpServer` -> `CopilotAdapter.installMcpServer` -> `addCopilotMcpServer` | WIRED |
| MCP-04 | `ack.deleteTool` -> `ToolManagerService` -> `CopilotAdapter.removeTool` -> `removeCopilotMcpServer` | WIRED |
| MCP-05 | `onDidSwitchAgent` -> `fileWatcher.setupWatchers` -> `getWatchPaths(Project)` returns `.vscode/mcp.json` | WIRED |
| INST-01 | `parseCopilotInstructions` reads `.github/copilot-instructions.md` via `CopilotAdapter.readTools(CustomPrompt, Project)` | WIRED |
| INST-02 | `parseCopilotInstructions` reads `.github/instructions/*.instructions.md` via same path | WIRED |
| INST-03 | `parseCopilotPrompts` reads `.github/prompts/*.prompt.md` via same path | WIRED |
| INST-04 | `handleCustomPromptInstall` (repo) + `installCustomPrompt` (registry) -> `CopilotAdapter.installInstruction` | WIRED |
| INST-05 | `ack.deleteTool` -> `CopilotAdapter.removeTool(CustomPrompt)` -> `fs.rm(tool.source.filePath)` | WIRED |
| INST-06 | `getRouteForTool(CustomPrompt)` = `'markdown'` -> `ack.openToolSource` -> `markdown.showPreview` | WIRED |
| AGNT-01 | `parseCopilotAgents` reads `.github/agents/*.agent.md` via `CopilotAdapter.readTools(Skill, Project)` | WIRED |
| AGNT-02 | `CopilotAdapter.toggleTool(Skill)` -> `toggleAgentUserInvokable` targeted frontmatter replacement | WIRED |
| AGNT-03 | `CopilotAdapter.installSkill` with `.agent.md` normalization via `InstallService` + marketplace | WIRED |
| AGNT-04 | `CopilotAdapter.removeTool(Skill)` -> `fs.rm(tool.source.filePath)` | WIRED |
| AGNT-05 | `getRouteForTool(Skill)` = `'markdown'` -> `ack.openToolSource` | WIRED |
| UX-04 | `toggleableToolTypes = {Skill}` -> `switchProfile` guard skips McpServer/CustomPrompt -> `nonToggleableSkipped` notification | WIRED |
| UX-05 | Profile export produces `.copilot.ackprofile` with `agentId: 'copilot'` -> import restores content | WIRED |
| UX-06 | `CopilotAdapter.supportedToolTypes` -> webview `TypeTabs` filters to mcp_server/skill/custom_prompt tabs + blue Copilot badge | WIRED |
| UX-07 | `ToolManifestSchema` accepts `custom_prompt` -> `InstallService.install` routes -> `CopilotAdapter.installInstruction` | WIRED |

---

## Tech Debt

| Phase | Item | Severity | Impact |
|-------|------|----------|--------|
| 20 | `writeTool` error message says "Phase 21+" — should be "Phase 22+" or removed | INFO | Cosmetic; method never called in production |
| 21 | `getJsonPath` path-string heuristic instead of adapter-metadata lookup | INFO | Works correctly; documented design decision |
| 23 | `getSkillsDir()` error message says "Phase 23+" — Phase 23 complete; method bypassed by `installSkill()` | INFO | Cosmetic; method never called in production |

**No blockers. No warnings. 3 INFO items.**

---

## Design Notes from Integration Check

1. **`installInstruction` is Copilot-specific** — accessed via `instanceof CopilotAdapter` cast, not an interface method. Future adapters supporting `custom_prompt` would need convention alignment or interface extension.

2. **Dual custom_prompt install paths** — `handleCustomPromptInstall` (repo-sourced) and `installCustomPrompt` (registry-sourced) are structurally parallel. Both need updating if logic changes.

3. **File path heuristic for MCP JSON key** — `getJsonPath()` identifies Copilot MCP files by string matching `.vscode` in the path. Works for current adapters; revisit if a future adapter uses the same path pattern.

---

## Commit Summary

| Phase | Commits | Key Commits |
|-------|---------|-------------|
| 20 | 5 | `58e9aba` CopilotPaths, `70d7aef` CopilotAdapter scaffold, `d0851d6` QuickPick + configDir |
| 21 | 7 | `73a8810` MCP schema, `216e1fa` parser, `83d0230` writer, `df95682` copilot-chat detection fix |
| 22 | 8 | Instructions/prompts parsers, tests, delete/install, marketplace routing, human verification fixes |
| 23 | 6 | `9472f58` agents parser, `d2585ef` writer + toggle, `942d783` installSkill filename fix |
| 24 | 3 | `toggleableToolTypes` interface, switchProfile guard, `nonToggleableSkipped` notification |
| 25 | 4 | AgentBadge + CSS, TypeTabs Instructions tab, ToolManifest schema, InstallService routing |

**Total: 33 commits across 6 phases, 17 plan files**

---

*Audit generated: 2026-02-26*
*Auditor: Claude (gsd-audit-milestone)*
*Integration checker: Claude (gsd-integration-checker, sonnet)*
